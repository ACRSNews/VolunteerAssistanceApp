<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Volunteer Sign-Up Helper</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #fdf8f0;
    --cream: #fff9ef;
    --card: #ffffff;
    --text: #1a1208;
    --muted: #7a6a50;
    --accent: #c84b2f;
    --accent2: #2b6e4e;
    --gold: #e8a020;
    --soft: #f2ece0;
    --border: #e8dece;
    --shadow: 0 4px 24px rgba(60,30,5,0.09);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    background: var(--accent2);
    padding: 18px 24px;
    display: flex;
    align-items: center;
    gap: 14px;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.15);
  }
  .header-icon {
    width: 44px; height: 44px;
    background: rgba(255,255,255,0.18);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }
  header h1 {
    font-family: 'Fraunces', serif;
    color: #fff;
    font-size: 22px;
    font-weight: 700;
    line-height: 1.1;
  }
  header p { color: rgba(255,255,255,0.75); font-size: 13px; margin-top: 2px; }

  /* â”€â”€ MAIN â”€â”€ */
  main {
    max-width: 680px;
    margin: 0 auto;
    padding: 24px 16px 48px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* â”€â”€ CARDS â”€â”€ */
  .card {
    background: var(--card);
    border-radius: 20px;
    box-shadow: var(--shadow);
    overflow: hidden;
    border: 1px solid var(--border);
  }
  .card-header {
    padding: 14px 20px 12px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--cream);
  }
  .step-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 28px; height: 28px;
    border-radius: 50%;
    font-weight: 700;
    font-size: 13px;
    flex-shrink: 0;
  }
  .step-badge.green  { background: var(--accent2); color: #fff; }
  .step-badge.red    { background: var(--accent); color: #fff; }
  .step-badge.gold   { background: var(--gold); color: #fff; }
  .step-badge.teal   { background: #2675a0; color: #fff; }
  .card-title {
    font-family: 'Fraunces', serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
  }
  .card-body { padding: 20px; }

  /* â”€â”€ LANGUAGE SELECTOR â”€â”€ */
  .lang-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 16px;
  }
  .lang-btn {
    border: 2px solid var(--border);
    background: var(--soft);
    border-radius: 14px;
    padding: 14px 10px;
    cursor: pointer;
    text-align: center;
    transition: all 0.15s;
    font-family: 'DM Sans', sans-serif;
  }
  .lang-btn:hover { border-color: var(--accent2); background: #e8f5ee; }
  .lang-btn.active { border-color: var(--accent2); background: #e8f5ee; box-shadow: 0 0 0 3px rgba(43,110,78,0.15); }
  .lang-btn .lang-native { font-size: 18px; font-weight: 600; display: block; margin-bottom: 2px; }
  .lang-btn .lang-english { font-size: 11px; color: var(--muted); }

  .voice-row {
    display: flex;
    gap: 10px;
    margin-top: 4px;
  }
  .btn-small {
    flex: 1;
    padding: 12px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.15s;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    min-height: 44px;
  }
  .btn-test { background: var(--accent2); color: #fff; }
  .btn-test:hover { background: #235c40; }
  .btn-stop { background: var(--soft); color: var(--text); border: 1px solid var(--border); }
  .btn-stop:hover { background: #e8dece; }

  /* â”€â”€ PHRASE BUTTONS â”€â”€ */
  .phrase-list { display: flex; flex-direction: column; gap: 10px; }

  .phrase-btn {
    display: flex;
    align-items: stretch;
    border: 1.5px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    background: var(--card);
    transition: all 0.15s;
    text-align: left;
    width: 100%;
    font-family: 'DM Sans', sans-serif;
  }
  .phrase-btn:hover { border-color: var(--accent2); box-shadow: 0 2px 10px rgba(43,110,78,0.12); }
  .phrase-btn.speaking { border-color: var(--accent); background: #fff8f6; }

  .phrase-icon {
    width: 56px;
    background: var(--soft);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }
  .phrase-content {
    padding: 12px 14px;
    flex: 1;
  }
  .phrase-english {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 3px;
  }
  .phrase-translated {
    font-size: 17px;
    font-weight: 600;
    color: var(--text);
    line-height: 1.3;
  }
  .phrase-speak-icon {
    width: 44px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    color: var(--accent2);
    flex-shrink: 0;
  }

  /* IMAGE SLOT */
  .image-slot {
    border: 2px dashed var(--border);
    border-radius: 14px;
    padding: 20px;
    text-align: center;
    color: var(--muted);
    margin-top: 14px;
    background: var(--soft);
    cursor: pointer;
    transition: border-color 0.15s;
    position: relative;
    overflow: hidden;
  }
  .image-slot:hover { border-color: var(--accent2); }
  .image-slot img { width: 100%; border-radius: 10px; object-fit: cover; max-height: 200px; display: block; }
  .image-slot input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
  .image-placeholder { font-size: 30px; margin-bottom: 6px; }
  .image-hint { font-size: 13px; }

  /* â”€â”€ LINKS â”€â”€ */
  .link-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .site-link {
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 8px;
    background: var(--accent);
    color: #fff;
    text-decoration: none;
    border-radius: 16px;
    padding: 20px 12px;
    text-align: center;
    font-weight: 700;
    font-size: 16px;
    transition: all 0.15s;
    box-shadow: 0 4px 14px rgba(200,75,47,0.3);
  }
  .site-link:hover { background: #a83920; transform: translateY(-2px); }
  .site-link .link-icon { font-size: 28px; }
  .site-link .link-label { font-family: 'Fraunces', serif; font-size: 18px; }
  .site-link .link-url { font-size: 11px; opacity: 0.8; font-weight: 400; word-break: break-all; }

  /* â”€â”€ CONFIRMATION â”€â”€ */
  .confirm-text {
    font-size: 20px;
    line-height: 1.5;
    font-family: 'Fraunces', serif;
    font-style: italic;
    color: var(--text);
    background: var(--soft);
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 14px;
    border-left: 4px solid var(--gold);
  }
  .confirm-english {
    font-size: 13px;
    color: var(--muted);
    margin-bottom: 14px;
    padding-left: 4px;
  }
  .btn-speak-confirm {
    width: 100%;
    padding: 16px;
    border-radius: 14px;
    border: none;
    background: var(--gold);
    color: #1a1208;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.15s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .btn-speak-confirm:hover { background: #c88a10; }

  /* â”€â”€ ADD PHRASE PANEL â”€â”€ */
  .add-phrase-section { margin-top: 20px; }
  .toggle-add-btn {
    width: 100%;
    background: none;
    border: 2px dashed var(--border);
    border-radius: 14px;
    padding: 14px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    font-weight: 600;
    color: var(--muted);
    transition: all 0.15s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .toggle-add-btn:hover { border-color: var(--accent2); color: var(--accent2); }
  .add-form {
    display: none;
    background: var(--soft);
    border-radius: 14px;
    padding: 18px;
    margin-top: 10px;
    border: 1px solid var(--border);
  }
  .add-form.open { display: block; }
  .form-grid { display: grid; gap: 10px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .form-group { display: flex; flex-direction: column; gap: 4px; }
  label.form-label { font-size: 12px; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
  input.form-input, select.form-select {
    padding: 12px;
    border-radius: 10px;
    border: 1.5px solid var(--border);
    background: #fff;
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    color: var(--text);
    width: 100%;
  }
  input.form-input:focus, select.form-select:focus { outline: none; border-color: var(--accent2); }
  .btn-add-confirm {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    background: var(--accent2);
    color: #fff;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.15s;
  }
  .btn-add-confirm:hover { background: #235c40; }

  .hint-text { font-size: 12px; color: var(--muted); margin-top: 10px; text-align: center; }
  .speaking-indicator {
    display: inline-block;
    width: 8px; height: 8px;
    background: var(--accent);
    border-radius: 50%;
    animation: pulse 0.8s ease-in-out infinite alternate;
  }
  @keyframes pulse { from { opacity:1; } to { opacity:0.2; } }

  .divider { height: 1px; background: var(--border); margin: 16px 0; }

  /* â”€â”€ LISTEN & TRANSLATE â”€â”€ */
  .listen-panel {
    margin-top: 14px;
    border: 2px solid var(--border);
    border-radius: 18px;
    overflow: hidden;
    background: #f8f4ff;
    border-color: #b8a4e8;
  }
  .listen-header {
    background: #6c3fc4;
    color: #fff;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 14px;
  }
  .listen-header .listen-icon { font-size: 20px; }
  .listen-body { padding: 16px; }
  .listen-lang-note {
    font-size: 12px;
    color: #6c3fc4;
    font-weight: 600;
    margin-bottom: 10px;
    background: #ede8ff;
    border-radius: 8px;
    padding: 6px 10px;
    display: inline-block;
  }
  .btn-listen {
    width: 100%;
    padding: 16px;
    border-radius: 14px;
    border: none;
    background: #6c3fc4;
    color: #fff;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.15s;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    margin-bottom: 12px;
  }
  .btn-listen:hover { background: #5530a0; }
  .btn-listen.listening {
    background: #c84b2f;
    animation: listen-pulse 1.2s ease-in-out infinite;
  }
  @keyframes listen-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(200,75,47,0.4); }
    50% { box-shadow: 0 0 0 10px rgba(200,75,47,0); }
  }
  .transcript-box {
    background: #fff;
    border: 1.5px solid #b8a4e8;
    border-radius: 12px;
    padding: 14px;
    min-height: 70px;
    font-size: 16px;
    color: var(--muted);
    font-style: italic;
    margin-bottom: 10px;
    line-height: 1.5;
  }
  .transcript-box.has-text { color: #6c3fc4; font-style: normal; font-weight: 600; }
  .translation-box {
    background: #edfaf2;
    border: 1.5px solid #7dc4a0;
    border-radius: 12px;
    padding: 14px;
    min-height: 60px;
    display: none;
  }
  .translation-box.visible { display: block; }
  .translation-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--accent2);
    margin-bottom: 6px;
  }
  .translation-text {
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.4;
  }
  .translation-subtext {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }
  .btn-translate {
    width: 100%;
    padding: 12px;
    border-radius: 12px;
    border: none;
    background: var(--accent2);
    color: #fff;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    margin-top: 10px;
    transition: background 0.15s;
    display: none;
  }
  .btn-translate.visible { display: block; }
  .btn-translate:hover { background: #235c40; }
  .translate-status {
    font-size: 12px;
    color: var(--muted);
    text-align: center;
    margin-top: 8px;
    min-height: 18px;
  }
  /* â”€â”€ PROGRAM CARDS â”€â”€ */
  .program-cards-wrapper {
    display: none;
    flex-direction: column;
    gap: 14px;
    margin-top: 14px;
  }
  .program-cards-wrapper.open { display: flex; }

  .program-card {
    border-radius: 18px;
    overflow: hidden;
    border: 1.5px solid var(--border);
    background: var(--card);
    box-shadow: 0 2px 12px rgba(60,30,5,0.07);
  }
  .program-card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 16px;
    cursor: pointer;
    user-select: none;
  }
  .program-card-header .prog-icon { font-size: 26px; flex-shrink: 0; }
  .program-card-header .prog-title {
    font-family: 'Fraunces', serif;
    font-size: 18px;
    font-weight: 700;
    flex: 1;
  }
  .program-card-header .prog-chevron {
    font-size: 14px;
    color: var(--muted);
    transition: transform 0.2s;
    flex-shrink: 0;
  }
  .program-card.expanded .prog-chevron { transform: rotate(180deg); }

  .program-card-body {
    display: none;
    padding: 0 16px 16px;
    border-top: 1px solid var(--border);
  }
  .program-card.expanded .program-card-body { display: block; }

  .prog-image-slot {
    border: 2px dashed var(--border);
    border-radius: 12px;
    margin: 14px 0 12px;
    overflow: hidden;
    position: relative;
    background: var(--soft);
    min-height: 60px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    transition: border-color 0.15s;
  }
  .prog-image-slot:hover { border-color: var(--accent2); }
  .prog-image-slot input[type=file] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
  .prog-image-slot img { width: 100%; max-height: 180px; object-fit: cover; display: block; }
  .prog-image-placeholder { display: flex; align-items: center; gap: 8px; padding: 14px; color: var(--muted); font-size: 13px; }

  .prog-schedule {
    font-size: 14px;
    font-weight: 700;
    color: var(--accent2);
    margin: 10px 0 4px;
    display: flex; align-items: center; gap: 6px;
  }
  .prog-location {
    font-size: 13px;
    color: var(--muted);
    margin: 6px 0 10px;
    line-height: 1.5;
    display: flex; gap: 6px;
  }
  .prog-tasks {
    background: var(--soft);
    border-radius: 12px;
    padding: 12px 14px;
    margin-bottom: 10px;
  }
  .prog-tasks-title {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--muted);
    margin-bottom: 8px;
  }
  .prog-task-item {
    font-size: 14px;
    color: var(--text);
    padding: 4px 0;
    display: flex; gap: 8px; align-items: flex-start;
    line-height: 1.4;
  }
  .prog-task-item::before { content: 'â€¢'; color: var(--accent2); font-weight: 700; flex-shrink: 0; }

  .prog-languages {
    font-size: 13px;
    color: #6c3fc4;
    background: #f0ecff;
    border-radius: 10px;
    padding: 9px 12px;
    margin-bottom: 10px;
    line-height: 1.5;
  }

  .btn-speak-program {
    width: 100%;
    padding: 13px;
    border-radius: 12px;
    border: none;
    background: var(--accent2);
    color: #fff;
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: background 0.15s;
    margin-top: 4px;
  }
  .btn-speak-program:hover { background: #235c40; }

  .prog-color-kitchen { background: linear-gradient(135deg, #fff5e6, #ffe8c8); }
  .prog-color-foodbank { background: linear-gradient(135deg, #e8f5ff, #c8e0ff); }
  .prog-color-farm { background: linear-gradient(135deg, #e8f5ec, #c8ead0); }
  .prog-color-messages { background: linear-gradient(135deg, #ffeef5, #ffd6e8); }

    font-size: 13px;
    color: #c84b2f;
    background: #fff0ed;
    border-radius: 10px;
    padding: 10px 12px;
    border: 1px solid #f4c4b8;
  }
</style>
</head>
<body>

<header>
  <div class="header-icon">ğŸ¤</div>
  <div>
    <h1>Volunteer Sign-Up Helper</h1>
    <p>Multilingual outreach tool Â· ACRS Community</p>
  </div>
</header>

<main>

  <!-- STEP 1: LANGUAGE -->
  <div class="card">
    <div class="card-header">
      <div class="step-badge green">1</div>
      <div class="card-title">Choose Language / é€‰æ‹©è¯­è¨€ / Chá»n ngÃ´n ngá»¯ / Pumili ng wika</div>
    </div>
    <div class="card-body">
      <div class="lang-grid" id="langGrid">
        <button class="lang-btn active" data-lang="zh-CN" onclick="selectLang('zh-CN', this)">
          <span class="lang-native">ç®€ä½“ä¸­æ–‡</span>
          <span class="lang-english">Simplified Chinese</span>
        </button>
        <button class="lang-btn" data-lang="zh-TW" onclick="selectLang('zh-TW', this)">
          <span class="lang-native">ç¹é«”ä¸­æ–‡</span>
          <span class="lang-english">Traditional Chinese</span>
        </button>
        <button class="lang-btn" data-lang="vi-VN" onclick="selectLang('vi-VN', this)">
          <span class="lang-native">Tiáº¿ng Viá»‡t</span>
          <span class="lang-english">Vietnamese</span>
        </button>
        <button class="lang-btn" data-lang="fil-PH" onclick="selectLang('fil-PH', this)">
          <span class="lang-native">Tagalog</span>
          <span class="lang-english">Filipino</span>
        </button>
      </div>

      <div class="voice-row">
        <button class="btn-small btn-test" onclick="testVoice()">ğŸ”Š Test Voice</button>
        <button class="btn-small btn-stop" onclick="stopSpeaking()">â¹ Stop</button>
      </div>
      <p class="hint-text">Tip: Tap "Test Voice" first to activate audio on mobile devices</p>
    </div>
  </div>

  <!-- STEP 2: PHRASES -->
  <div class="card">
    <div class="card-header">
      <div class="step-badge red">2</div>
      <div class="card-title">Tap a Phrase to Speak</div>
    </div>
    <div class="card-body">
      <div class="phrase-list" id="phraseList"></div>

      <!-- PROGRAM CARDS (shown when "which program" phrase is tapped) -->
      <div class="program-cards-wrapper" id="programCards">

        <!-- Club Bamboo Kitchen -->
        <div class="program-card" id="card-kitchen">
          <div class="program-card-header prog-color-kitchen" onclick="toggleCard('card-kitchen')">
            <span class="prog-icon">ğŸœ</span>
            <span class="prog-title">Club Bamboo Kitchen</span>
            <span class="prog-chevron">â–¼</span>
          </div>
          <div class="program-card-body">
            <div class="prog-image-slot" id="imgslot-kitchen">
              <input type="file" accept="image/*" onchange="handleProgImage(event,'imgslot-kitchen')">
              <div class="prog-image-placeholder">ğŸ“· Tap to add a photo of the Kitchen</div>
            </div>
            <div class="prog-schedule">ğŸ•˜ Mondays â€“ Fridays, 9:00 AM â€“ 12:00 PM</div>
            <div class="prog-schedule" style="margin-top:2px;">ğŸ•› Tuesdays, Thursdays & Fridays, 12:00 â€“ 3:00 PM</div>
            <div class="prog-location">ğŸ“ Located here at our main building, on the first floor â€” that way.</div>
            <div class="prog-tasks">
              <div class="prog-tasks-title">What you'll do</div>
              <div class="prog-task-item">Prepping food to feed elders and our community</div>
              <div class="prog-task-item">Washing dishes and handing meals to the community</div>
            </div>
            <div class="prog-languages">ğŸ—£ï¸ Chef Keuan speaks Lao, Chinese, and Vietnamese. Other staff speak Cantonese and Mandarin.</div>
            <button class="btn-speak-program" onclick="speakProgram('kitchen')">ğŸ”Š Speak this info</button>
          </div>
        </div>

        <!-- Food Bank -->
        <div class="program-card" id="card-foodbank">
          <div class="program-card-header prog-color-foodbank" onclick="toggleCard('card-foodbank')">
            <span class="prog-icon">ğŸ¥«</span>
            <span class="prog-title">Food Bank</span>
            <span class="prog-chevron">â–¼</span>
          </div>
          <div class="program-card-body">
            <div class="prog-image-slot" id="imgslot-foodbank">
              <input type="file" accept="image/*" onchange="handleProgImage(event,'imgslot-foodbank')">
              <div class="prog-image-placeholder">ğŸ“· Tap to add a photo of the Food Bank</div>
            </div>
            <div class="prog-schedule">ğŸ•˜ Tuesday â€“ Friday, 9:00 AM â€“ 1:00 PM</div>
            <div class="prog-location">ğŸ“ 800 Weller St., Chinatown/International District</div>
            <div class="prog-tasks">
              <div class="prog-tasks-title">What you'll do</div>
              <div class="prog-task-item">Prepping grocery bags for delivery</div>
              <div class="prog-task-item">Assembling and packaging food</div>
              <div class="prog-task-item">Loading and unloading food into delivery vehicles</div>
              <div class="prog-task-item">Handing out food to clients (Wednesdays and Fridays)</div>
            </div>
            <button class="btn-speak-program" onclick="speakProgram('foodbank')">ğŸ”Š Speak this info</button>
          </div>
        </div>

        <!-- Seattle Community Farm -->
        <div class="program-card" id="card-farm">
          <div class="program-card-header prog-color-farm" onclick="toggleCard('card-farm')">
            <span class="prog-icon">ğŸŒ¿</span>
            <span class="prog-title">Seattle Community Farm</span>
            <span class="prog-chevron">â–¼</span>
          </div>
          <div class="program-card-body">
            <div class="prog-image-slot" id="imgslot-farm">
              <input type="file" accept="image/*" onchange="handleProgImage(event,'imgslot-farm')">
              <div class="prog-image-placeholder">ğŸ“· Tap to add a photo of the Farm</div>
            </div>
            <div class="prog-schedule">ğŸ•˜ Mondays, 9:30 AM â€“ 4:00 PM (come anytime in between)</div>
            <div class="prog-location">ğŸ“ Corner of S. Lilac St. & Martin Luther King Jr. Way S., behind Rainier Valley Housing â€” about a 7 minute walk down the street.</div>
            <div class="prog-tasks">
              <div class="prog-tasks-title">What you'll do</div>
              <div class="prog-task-item">Weeding</div>
            </div>
            <div class="prog-languages">ğŸ—£ï¸ Ms. Yu Chen, who manages the farm, speaks Cantonese, some Vietnamese, Taishanese, Mandarin, and other Chinese dialects.</div>
            <button class="btn-speak-program" onclick="speakProgram('farm')">ğŸ”Š Speak this info</button>
          </div>
        </div>

        <!-- Caring Messages -->
        <div class="program-card" id="card-messages">
          <div class="program-card-header prog-color-messages" onclick="toggleCard('card-messages')">
            <span class="prog-icon">ğŸ’Œ</span>
            <span class="prog-title">Caring Messages</span>
            <span class="prog-chevron">â–¼</span>
          </div>
          <div class="program-card-body">
            <div class="prog-image-slot" id="imgslot-messages">
              <input type="file" accept="image/*" onchange="handleProgImage(event,'imgslot-messages')">
              <div class="prog-image-placeholder">ğŸ“· Tap to add a photo</div>
            </div>
            <div class="prog-schedule">ğŸ• Timing is flexible</div>
            <div class="prog-location">ğŸ’› Write messages to our elders that will be distributed at our food bank.</div>
            <button class="btn-speak-program" onclick="speakProgram('messages')">ğŸ”Š Speak this info</button>
          </div>
        </div>

      </div><!-- end program-cards-wrapper -->
      <div class="image-slot" id="imageSlot">
        <input type="file" accept="image/*" onchange="handleImageUpload(event)" title="Upload image">
        <div id="imageSlotContent">
          <div class="image-placeholder">ğŸ–¼ï¸</div>
          <div class="image-hint">Optional: tap to add a photo or visual aid</div>
        </div>
      </div>

      <!-- LISTEN & TRANSLATE -->
      <div class="listen-panel" id="listenPanel">
        <div class="listen-header">
          <span class="listen-icon">ğŸ‘‚</span>
          <div>
            <div>Listen &amp; Translate to English</div>
            <div style="font-weight:400;font-size:12px;opacity:0.85;">Let the volunteer speak â€” see it in English</div>
          </div>
        </div>
        <div class="listen-body">
          <div class="listen-lang-note" id="listenLangNote">Listening for: Simplified Chinese</div>

          <!-- Two-button layout: Start + Stop always visible -->
          <div style="display:flex;gap:10px;margin-bottom:12px;">
            <button class="btn-listen" id="listenBtn" onclick="startListening()" style="flex:1;">
              ğŸ¤ Start Listening
            </button>
            <button id="stopListenBtn" onclick="stopListening()"
              style="flex:0 0 auto;padding:14px 18px;border-radius:14px;border:none;background:#e9ebf3;color:#111;font-family:DM Sans,sans-serif;font-weight:700;font-size:15px;cursor:pointer;min-height:48px;">
              â¹ Stop
            </button>
          </div>

          <div class="transcript-box" id="transcriptBox">
            Volunteer's speech will appear hereâ€¦
          </div>

          <button class="btn-translate" id="translateBtn" onclick="translateText()">
            ğŸŒ Translate to English
          </button>

          <div class="translation-box" id="translationBox">
            <div class="translation-label">ğŸ‡ºğŸ‡¸ English Translation</div>
            <div class="translation-text" id="translationText"></div>
            <div class="translation-subtext">Translated from <span id="translationFrom"></span></div>
          </div>

          <div class="translate-status" id="translateStatus"></div>
        </div>
      </div>

      <!-- ADD PHRASE -->
      <div class="add-phrase-section">
        <button class="toggle-add-btn" onclick="toggleAddForm()">â• Add a New Phrase</button>
        <div class="add-form" id="addForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">English (label)</label>
              <input class="form-input" id="new_english" type="text" placeholder="e.g. Do you speak English?" />
            </div>
            <div class="form-group">
              <label class="form-label">Icon (emoji)</label>
              <input class="form-input" id="new_icon" type="text" placeholder="ğŸ—£ï¸" maxlength="2" />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">ç®€ä½“ä¸­æ–‡</label>
                <input class="form-input" id="new_zhCN" type="text" placeholder="Translationâ€¦" />
              </div>
              <div class="form-group">
                <label class="form-label">ç¹é«”ä¸­æ–‡</label>
                <input class="form-input" id="new_zhTW" type="text" placeholder="Translationâ€¦" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Tiáº¿ng Viá»‡t</label>
                <input class="form-input" id="new_vi" type="text" placeholder="Translationâ€¦" />
              </div>
              <div class="form-group">
                <label class="form-label">Tagalog</label>
                <input class="form-input" id="new_fil" type="text" placeholder="Translationâ€¦" />
              </div>
            </div>
          </div>
          <button class="btn-add-confirm" onclick="addPhrase()">âœ… Add Phrase</button>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 3: SIGN-UP LINKS -->
  <div class="card">
    <div class="card-header">
      <div class="step-badge teal">3</div>
      <div class="card-title">Open Sign-Up Links</div>
    </div>
    <div class="card-body">
      <div class="link-grid">
        <a class="site-link" href="https://www.bit.ly/ACRSFOODBANKSHIFTS" target="_blank" rel="noopener">
          <span class="link-icon">ğŸ¥«</span>
          <span class="link-label">Food Bank</span>
          <span class="link-url">bit.ly/ACRSFOODBANKSHIFTS</span>
        </a>
        <a class="site-link" href="https://www.bit.ly/CBKITCHENSHIFTS" target="_blank" rel="noopener">
          <span class="link-icon">ğŸ²</span>
          <span class="link-label">Kitchen</span>
          <span class="link-url">bit.ly/CBKITCHENSHIFTS</span>
        </a>
      </div>
      <p class="hint-text" style="margin-top:12px;">If links don't open, copy the URL into your browser</p>
    </div>
  </div>

  <!-- STEP 4: CONFIRMATION -->
  <div class="card">
    <div class="card-header">
      <div class="step-badge gold">4</div>
      <div class="card-title">Confirmation Message</div>
    </div>
    <div class="card-body">
      <p class="confirm-english">
        "Great! Next, open the link to sign up. If you don't have an email, that's okay â€” we can help you."
      </p>
      <div class="confirm-text" id="confirmText"></div>
      <button class="btn-speak-confirm" onclick="speakConfirm()">
        ğŸ”Š Speak Confirmation
      </button>
    </div>
  </div>

</main>

<script>
// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANGS = {
  "zh-CN": "ç®€ä½“ä¸­æ–‡",
  "zh-TW": "ç¹é«”ä¸­æ–‡",
  "vi-VN": "Tiáº¿ng Viá»‡t",
  "fil-PH": "Tagalog"
};

let phrases = [
  {
    key: "want_volunteer",
    label: "Would you like to volunteer?",
    icon: "ğŸ¤",
    t: {
      // Natural, warm â€” direct and friendly for all dialects
      "zh-CN": "ä½ æœ‰å…´è¶£æ¥åšä¹‰å·¥å—ï¼Ÿ",
      // zh-TW: ç¾©å·¥ is the natural Taiwan term; ä½ æœ‰ is warmer than ä½ æƒ³
      "zh-TW": "ä½ æœ‰èˆˆè¶£ä¾†ç•¶ç¾©å·¥å—ï¼Ÿ",
      // Warmer: "Báº¡n cÃ³ muá»‘n" â†’ thÃªm "tham gia cÃ¹ng chÃºng tÃ´i" sounds inviting
      "vi-VN": "Báº¡n cÃ³ muá»‘n lÃ m tÃ¬nh nguyá»‡n viÃªn cÃ¹ng chÃºng tÃ´i khÃ´ng áº¡?",
      // Natural Tagalog â€” "kami" adds warmth
      "fil-PH": "Gusto mo bang maging volunteer namin?"
    }
  },
  {
    key: "which_program",
    label: "Where/How would you like to volunteer with us?",
    icon: "ğŸŒ±",
    showPrograms: true,
    t: {
      // More natural spoken Mandarin â€” æƒ³åœ¨å“ªé‡Œ is colloquial
      "zh-CN": "ä½ æƒ³åœ¨å“ªé‡Œè·Ÿæˆ‘ä»¬ä¸€èµ·åšä¹‰å·¥å‘¢ï¼Ÿ",
      // Natural Taiwan phrasing
      "zh-TW": "ä½ æƒ³åœ¨å“ªè£¡è·Ÿæˆ‘å€‘ä¸€èµ·ç•¶ç¾©å·¥å‘¢ï¼Ÿ",
      // Spoken Vietnamese â€” "tham gia tÃ¬nh nguyá»‡n á»Ÿ Ä‘Ã¢u" flows naturally
      "vi-VN": "Báº¡n muá»‘n tham gia tÃ¬nh nguyá»‡n á»Ÿ Ä‘Ã¢u vá»›i chÃºng tÃ´i áº¡?",
      // Natural â€” "saan" placement is correct
      "fil-PH": "Saan mo gustong mag-volunteer kasama kami?"
    }
  },
  {
    key: "have_email",
    label: "Do you have an email address?",
    icon: "ğŸ“§",
    t: {
      // é‚®ç®± is the everyday word; ç”µå­é‚®ä»¶ sounds overly formal in speech
      "zh-CN": "ä½ æœ‰é‚®ç®±å—ï¼Ÿ",
      // Taiwan: é›»å­éƒµä»¶ is standard; ä¿¡ç®± also common but email is understood
      "zh-TW": "ä½ æœ‰é›»å­éƒµä»¶ä¿¡ç®±å—ï¼Ÿ",
      // Casual spoken Vietnamese drops "Ä‘á»‹a chá»‰" â€” just "email" is natural
      "vi-VN": "Báº¡n cÃ³ email khÃ´ng áº¡?",
      // Perfect as-is
      "fil-PH": "May email address ka ba?"
    }
  },
  {
    key: "what_email",
    label: "What is your email address?",
    icon: "âœ‰ï¸",
    t: {
      // é‚®ç®±åœ°å€ is natural spoken Mandarin
      "zh-CN": "ä½ çš„é‚®ç®±åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿ",
      "zh-TW": "ä½ çš„é›»å­éƒµä»¶ä¿¡ç®±æ˜¯ä»€éº¼ï¼Ÿ",
      // "Email cá»§a báº¡n lÃ  gÃ¬" is perfectly natural
      "vi-VN": "Email cá»§a báº¡n lÃ  gÃ¬ váº­y?",
      // "váº­y" adds natural conversational softness
      "fil-PH": "Ano ang iyong email address?"
    }
  },
  {
    key: "no_email",
    label: "No email? No problem â€” we can help. What days at 9:00 am can you meet?",
    icon: "ğŸ™Œ",
    t: {
      // Warm, natural Mandarin â€” æ²¡æœ‰ä¹Ÿæ²¡å…³ç³» is very colloquial
      "zh-CN": "æ²¡æœ‰é‚®ç®±ä¹Ÿå®Œå…¨æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¸®ä½ ã€‚ä½ å“ªå‡ å¤©æ—©ä¸Šä¹ç‚¹æœ‰ç©ºæ¥è§æˆ‘ï¼Ÿ",
      "zh-TW": "æ²’æœ‰é›»å­éƒµä»¶ä¹Ÿå®Œå…¨æ²’é—œä¿‚ï¼Œæˆ‘å€‘å¯ä»¥å¹«ä½ ã€‚ä½ å“ªå¹¾å¤©æ—©ä¸Šä¹é»æœ‰ç©ºä¾†è¦‹æˆ‘ï¼Ÿ",
      // Natural Vietnamese â€” "cÅ©ng Ä‘Æ°á»£c" is very colloquial for "it's okay"
      "vi-VN": "KhÃ´ng cÃ³ email cÅ©ng Ä‘Æ°á»£c, khÃ´ng sao háº¿t! ChÃºng tÃ´i sáº½ giÃºp báº¡n. Báº¡n cÃ³ thá»ƒ gáº·p tÃ´i lÃºc chÃ­n giá» sÃ¡ng vÃ o nhá»¯ng ngÃ y nÃ o?",
      // Natural Tagalog â€” "wag mag-alala" adds warmth
      "fil-PH": "Wag mag-alala kung wala kang email â€” tulungan ka namin. Anong araw ka pwedeng makipagkita sa amin ng 9 ng umaga?"
    }
  }
];

const CONFIRM = {
  // Natural, warm Mandarin closing
  "zh-CN": "å¤ªå¥½äº†ï¼æ¥ä¸‹æ¥è¯·æ‰“å¼€é“¾æ¥æŠ¥åã€‚æ²¡æœ‰é‚®ç®±çš„è¯ä¹Ÿå®Œå…¨æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¼šå¸®ä½ çš„ã€‚",
  "zh-TW": "å¤ªå¥½äº†ï¼æ¥ä¸‹ä¾†è«‹æ‰“é–‹é€£çµå ±åã€‚æ²’æœ‰é›»å­éƒµä»¶ä¹Ÿå®Œå…¨æ²’é—œä¿‚ï¼Œæˆ‘å€‘æœƒå¹«ä½ çš„ã€‚",
  // "Hay quÃ¡!" is very natural Vietnamese exclamation; "Ä‘á»«ng lo" = don't worry, very warm
  "vi-VN": "Hay quÃ¡! BÃ¢y giá» báº¡n má»Ÿ Ä‘Æ°á»ng link Ä‘á»ƒ Ä‘Äƒng kÃ½ nhÃ©. Náº¿u khÃ´ng cÃ³ email thÃ¬ Ä‘á»«ng lo â€” chÃºng tÃ´i sáº½ giÃºp báº¡n.",
  // "Ang galing!" is natural Tagalog praise; "huwag mag-alala" = don't worry
  "fil-PH": "Ang galing! Buksan mo na ang link para mag-sign up. Kung wala kang email, huwag mag-alala â€” tutulungan ka namin."
};

const TEST_PHRASES = {
  "zh-CN": "ä½ å¥½ï¼æ¬¢è¿ï¼",
  "zh-TW": "ä½ å¥½ï¼æ­¡è¿ï¼",
  "vi-VN": "Xin chÃ o! ChÃ o má»«ng báº¡n!",
  "fil-PH": "Kumusta! Maligayang pagdating!"
};

let currentLang = "zh-CN";
let speakingKey = null;

// â”€â”€ SPEECH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function chooseVoice(lang) {
  const voices = window.speechSynthesis.getVoices();
  if (!voices.length) return null;

  // For Vietnamese: prefer Google vi-VN, then any vi voice
  if (lang === 'vi-VN') {
    const googleVi = voices.find(v => v.lang === 'vi-VN' && v.name.includes('Google'));
    if (googleVi) return googleVi;
    const anyVi = voices.find(v => v.lang === 'vi-VN' || v.lang === 'vi');
    if (anyVi) return anyVi;
  }

  // For Chinese: prefer Google voices, avoid robot-sounding ones
  if (lang === 'zh-CN' || lang === 'zh-TW') {
    const googleZh = voices.find(v => v.lang.startsWith(lang.split('-')[0]) && v.name.includes('Google'));
    if (googleZh) return googleZh;
  }

  const exact = voices.find(v => v.lang.toLowerCase() === lang.toLowerCase());
  if (exact) return exact;
  const prefix = lang.split('-')[0].toLowerCase();
  return voices.find(v => v.lang.toLowerCase().startsWith(prefix)) || null;
}

function speak(text, lang, key) {
  if (!('speechSynthesis' in window)) { alert("Text-to-Speech not supported in this browser."); return; }
  stopSpeaking();
  speakingKey = key || null;
  renderPhrases();

  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = lang;

  // Vietnamese sounds much more natural at slightly slower rate
  if (lang === 'vi-VN') {
    utter.rate = 0.88;
    utter.pitch = 1.05;
  } else if (lang === 'zh-CN' || lang === 'zh-TW') {
    utter.rate = 0.92;
  } else {
    utter.rate = 0.95;
  }

  // Wait for voices to load if needed
  const setVoiceAndSpeak = () => {
    const voice = chooseVoice(lang);
    if (voice) utter.voice = voice;
    utter.onend = () => { speakingKey = null; renderPhrases(); };
    utter.onerror = () => { speakingKey = null; renderPhrases(); };
    window.speechSynthesis.speak(utter);
  };

  const voices = window.speechSynthesis.getVoices();
  if (voices.length > 0) {
    setVoiceAndSpeak();
  } else {
    window.speechSynthesis.onvoiceschanged = () => {
      window.speechSynthesis.onvoiceschanged = null;
      setVoiceAndSpeak();
    };
  }
}

function stopSpeaking() {
  try { window.speechSynthesis.cancel(); } catch(e){}
  speakingKey = null;
  renderPhrases();
}

function testVoice() {
  speak(TEST_PHRASES[currentLang], currentLang, '__test__');
}

function speakConfirm() {
  speak(CONFIRM[currentLang], currentLang, '__confirm__');
}

// â”€â”€ LANGUAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function selectLang(lang, btn) {
  currentLang = lang;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderPhrases();
  updateConfirm();
  updateListenPanel();
  // Reset listen panel on language change
  isListening = false;
  if (recognition) { try { recognition.abort(); } catch(e) {} recognition = null; }
  capturedTranscript = '';
  document.getElementById('transcriptBox').className = 'transcript-box';
  document.getElementById('transcriptBox').textContent = "Volunteer's speech will appear hereâ€¦";
  document.getElementById('translateBtn').style.display = 'none';
  document.getElementById('translationBox').classList.remove('visible');
  document.getElementById('translateStatus').textContent = '';
  _setIdleBtn();
}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderPhrases() {
  const list = document.getElementById('phraseList');
  list.innerHTML = '';

  phrases.forEach((p, idx) => {
    const isSpeaking = speakingKey === p.key;
    const btn = document.createElement('button');
    btn.className = 'phrase-btn' + (isSpeaking ? ' speaking' : '');
    btn.setAttribute('aria-label', `Speak: ${p.label}`);
    btn.onclick = () => {
      speak(p.t[currentLang] || p.label, currentLang, p.key);
      if (p.showPrograms) {
        const wrapper = document.getElementById('programCards');
        wrapper.classList.add('open');
        wrapper.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    };

    btn.innerHTML = `
      <div class="phrase-icon">${p.icon || 'ğŸ’¬'}</div>
      <div class="phrase-content">
        <div class="phrase-english">${p.label}</div>
        <div class="phrase-translated">${p.t[currentLang] || '<em style="color:#aaa">No translation</em>'}</div>
      </div>
      <div class="phrase-speak-icon">${isSpeaking ? '<span class="speaking-indicator"></span>' : 'ğŸ”Š'}</div>
    `;
    list.appendChild(btn);
  });
}

function updateConfirm() {
  document.getElementById('confirmText').textContent = CONFIRM[currentLang] || '';
}

// â”€â”€ ADD PHRASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAddForm() {
  document.getElementById('addForm').classList.toggle('open');
}

function addPhrase() {
  const english = document.getElementById('new_english').value.trim();
  if (!english) { alert('Please enter an English label.'); return; }

  const icon = document.getElementById('new_icon').value.trim() || 'ğŸ’¬';
  const zhCN = document.getElementById('new_zhCN').value.trim();
  const zhTW = document.getElementById('new_zhTW').value.trim();
  const vi   = document.getElementById('new_vi').value.trim();
  const fil  = document.getElementById('new_fil').value.trim();

  phrases.push({
    key: 'custom_' + Date.now(),
    label: english,
    icon: icon,
    t: { "zh-CN": zhCN, "zh-TW": zhTW, "vi-VN": vi, "fil-PH": fil }
  });

  // Clear
  ['new_english','new_icon','new_zhCN','new_zhTW','new_vi','new_fil'].forEach(id => {
    document.getElementById(id).value = '';
  });

  renderPhrases();
  toggleAddForm();
}

// â”€â”€ IMAGE UPLOAD (general) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handleImageUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const slot = document.getElementById('imageSlotContent');
    slot.innerHTML = `<img src="${e.target.result}" alt="Uploaded visual aid" />
      <div class="image-hint" style="margin-top:8px;">Tap to change image</div>`;
  };
  reader.readAsDataURL(file);
}

// â”€â”€ PROGRAM CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleCard(id) {
  const card = document.getElementById(id);
  card.classList.toggle('expanded');
}

function handleProgImage(event, slotId) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = e => {
    const slot = document.getElementById(slotId);
    slot.innerHTML = `<img src="${e.target.result}" alt="Program photo" /><input type="file" accept="image/*" onchange="handleProgImage(event,'${slotId}')" style="position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;">`;
  };
  reader.readAsDataURL(file);
}

// Program spoken descriptions per language
const PROGRAM_SPEAK = {
  kitchen: {
    "zh-CN": "ç«¹å›­å¨æˆ¿ã€‚æ—¶é—´æ˜¯å‘¨ä¸€åˆ°å‘¨äº”æ—©ä¸Šä¹ç‚¹åˆ°åäºŒç‚¹ï¼Œå‘¨äºŒã€å‘¨å››ã€å‘¨äº”ä¸‹åˆåäºŒç‚¹åˆ°ä¸‰ç‚¹ã€‚å°±åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»æ¥¼çš„ä¸€æ¥¼ï¼Œå¾€é‚£ä¸ªæ–¹å‘èµ°ã€‚ä½ ä¼šå¸®å¿™å¤‡é¤ï¼Œç…§é¡¾æˆ‘ä»¬çš„é•¿è¾ˆå’Œç¤¾åŒºæˆå‘˜ï¼Œæ´—ç¢—ï¼Œè¿˜æœ‰ç»™å¤§å®¶åˆ†å‘é¤é£Ÿã€‚å¨å¸ˆKeuanä¼šè¯´è€æŒè¯­ã€ä¸­æ–‡å’Œè¶Šå—è¯­ï¼Œå…¶ä»–å·¥ä½œäººå‘˜ä¼šè¯´å¹¿ä¸œè¯å’Œæ™®é€šè¯ã€‚",
    "zh-TW": "ç«¹åœ’å»šæˆ¿ã€‚æ™‚é–“æ˜¯é€±ä¸€åˆ°é€±äº”æ—©ä¸Šä¹é»åˆ°åäºŒé»ï¼Œé€±äºŒã€é€±å››ã€é€±äº”ä¸‹åˆåäºŒé»åˆ°ä¸‰é»ã€‚å°±åœ¨é€™è£¡æˆ‘å€‘ä¸»æ¨“çš„ä¸€æ¨“ï¼Œå¾€é‚£å€‹æ–¹å‘èµ°ã€‚ä½ æœƒå¹«å¿™å‚™é¤ï¼Œç…§é¡§æˆ‘å€‘çš„é•·è¼©å’Œç¤¾å€æˆå“¡ï¼Œæ´—ç¢—ï¼Œé‚„æœ‰çµ¦å¤§å®¶åˆ†ç™¼é¤é£Ÿã€‚å»šå¸«Keuanæœƒèªªå¯®èªã€ä¸­æ–‡å’Œè¶Šå—èªï¼Œå…¶ä»–å·¥ä½œäººå“¡æœƒèªªå»£æ±è©±å’Œåœ‹èªã€‚",
    // Natural spoken Vietnamese â€” conversational, warm, uses "mÃ¬nh" register
    "vi-VN": "Báº¿p Club Bamboo nha. Má»Ÿ cá»­a tá»« thá»© Hai Ä‘áº¿n thá»© SÃ¡u, chÃ­n giá» Ä‘áº¿n mÆ°á»i hai giá» trÆ°a. Thá»© Ba, thá»© NÄƒm vÃ  thá»© SÃ¡u thÃ¬ thÃªm buá»•i chiá»u tá»« mÆ°á»i hai giá» Ä‘áº¿n ba giá». á» ngay Ä‘Ã¢y, táº§ng má»™t cá»§a tÃ²a nhÃ  chÃ­nh, Ä‘i theo hÆ°á»›ng Ä‘Ã³. Báº¡n sáº½ phá»¥ náº¥u Äƒn cho cÃ¡c cá»¥ giÃ  vÃ  cá»™ng Ä‘á»“ng, rá»­a chÃ©n bÃ¡t, vÃ  phÃ¡t bá»¯a Äƒn. Anh Ä‘áº§u báº¿p Keuan nÃ³i Ä‘Æ°á»£c tiáº¿ng LÃ o, tiáº¿ng Trung vÃ  tiáº¿ng Viá»‡t. CÃ¡c nhÃ¢n viÃªn khÃ¡c nÃ³i tiáº¿ng Quáº£ng vÃ  tiáº¿ng Phá»• thÃ´ng.",
    // Natural Tagalog â€” "po" adds respect, natural flow
    "fil-PH": "Club Bamboo Kitchen po. Bukas Lunes hanggang Biyernes, ika-siyam ng umaga hanggang ika-labindalawa ng tanghali. Martes, Huwebes at Biyernes, dagdag pa ang hapon mula ika-labindalawa hanggang ika-tatlo. Nandito po mismo sa unang palapag ng aming pangunahing gusali, sa gawi noon. Magtutulungan kayo sa paghahanda ng pagkain para sa mga lolo lola at komunidad, paghuhugas ng pinggan, at pamimigay ng pagkain. Si Chef Keuan ay nagsasalita ng Lao, Tsino, at Vietnamese. Ang iba pang mga kawani ay nagsasalita ng Cantonese at Mandarin."
  },
  foodbank: {
    "zh-CN": "é£Ÿç‰©é“¶è¡Œã€‚æ—¶é—´æ˜¯å‘¨äºŒåˆ°å‘¨äº”æ—©ä¸Šä¹ç‚¹åˆ°ä¸‹åˆä¸€ç‚¹ã€‚åœ°å€åœ¨å”äººè¡—å›½é™…åŒºå¨å‹’è¡—å…«ç™¾å·ã€‚ä½ ä¼šå¸®å¿™å‡†å¤‡å¤–é€çš„é£Ÿå“è¢‹ã€åŒ…è£…é£Ÿç‰©ã€æŠŠé£Ÿç‰©è£…ä¸Šå’Œå¸ä¸‹é…é€è½¦ï¼Œå‘¨ä¸‰å’Œå‘¨äº”è¿˜ä¼šç›´æ¥æŠŠé£Ÿç‰©å‘ç»™æ¥å–çš„å±…æ°‘ã€‚",
    "zh-TW": "é£Ÿç‰©éŠ€è¡Œã€‚æ™‚é–“æ˜¯é€±äºŒåˆ°é€±äº”æ—©ä¸Šä¹é»åˆ°ä¸‹åˆä¸€é»ã€‚åœ°å€åœ¨å”äººè¡—åœ‹éš›å€å¨å‹’è¡—å…«ç™¾è™Ÿã€‚ä½ æœƒå¹«å¿™æº–å‚™å¤–é€çš„é£Ÿå“è¢‹ã€åŒ…è£é£Ÿç‰©ã€æŠŠé£Ÿç‰©è£ä¸Šå’Œå¸ä¸‹é…é€è»Šï¼Œé€±ä¸‰å’Œé€±äº”é‚„æœƒç›´æ¥æŠŠé£Ÿç‰©ç™¼çµ¦ä¾†é ˜çš„å±…æ°‘ã€‚",
    // Natural â€” "bÃ  con" is warm Vietnamese for community members
    "vi-VN": "NgÃ¢n hÃ ng thá»±c pháº©m nha. Má»Ÿ cá»­a tá»« thá»© Ba Ä‘áº¿n thá»© SÃ¡u, chÃ­n giá» sÃ¡ng Ä‘áº¿n má»™t giá» chiá»u. Äá»‹a chá»‰ lÃ  sá»‘ tÃ¡m trÄƒm Ä‘Æ°á»ng Weller, khu Chinatown vÃ  International District. Báº¡n sáº½ Ä‘Ã³ng gÃ³i tÃºi thá»±c pháº©m Ä‘á»ƒ giao cho bÃ  con, sáº¯p xáº¿p vÃ  bá»c thá»±c pháº©m, bá»‘c vÃ¡c lÃªn xuá»‘ng xe giao hÃ ng. Thá»© TÆ° vÃ  thá»© SÃ¡u thÃ¬ phÃ¡t trá»±c tiáº¿p thá»±c pháº©m cho khÃ¡ch hÃ ng.",
    "fil-PH": "Food Bank po. Bukas Martes hanggang Biyernes, ika-siyam ng umaga hanggang ika-isa ng hapon. Nasa 800 Weller Street po, sa Chinatown at International District. Maghahanda kayo ng grocery bags para sa delivery, mag-aayos at mag-iimpake ng pagkain, at mag-lo-load at mag-u-unload ng pagkain sa mga delivery vehicle. Tuwing Miyerkules at Biyernes, mamimigay din kayo ng pagkain direkta sa mga kliyente."
  },
  farm: {
    "zh-CN": "è¥¿é›…å›¾ç¤¾åŒºå†œåœºã€‚æ—¶é—´æ˜¯æ¯å‘¨ä¸€æ—©ä¸Šä¹ç‚¹åŠåˆ°ä¸‹åˆå››ç‚¹ï¼Œä¸­é—´éšæ—¶æ¥éƒ½å¯ä»¥ã€‚åœ°ç‚¹åœ¨å—ä¸é¦™è¡—å’Œé©¬ä¸è·¯å¾·é‡‘å¤§é“å—çš„äº¤å‰å£ï¼Œé›·å°¼å°”è°·ä½å®…åé¢ï¼Œä»è¿™é‡Œèµ°è·¯å¤§çº¦ä¸ƒåˆ†é’Ÿã€‚ä½ ä¼šå¸®å¿™é™¤è‰ã€‚å†œåœºç»ç†ä½™æ™¨å¥³å£«ä¼šè¯´å¹¿ä¸œè¯ã€ä¸€ç‚¹è¶Šå—è¯ã€å°å±±è¯ã€æ™®é€šè¯ï¼Œè¿˜æœ‰å…¶ä»–ä¸­å›½æ–¹è¨€ã€‚",
    "zh-TW": "è¥¿é›…åœ–ç¤¾å€è¾²å ´ã€‚æ™‚é–“æ˜¯æ¯é€±ä¸€æ—©ä¸Šä¹é»åŠåˆ°ä¸‹åˆå››é»ï¼Œä¸­é–“éš¨æ™‚ä¾†éƒ½å¯ä»¥ã€‚åœ°é»åœ¨å—ä¸é¦™è¡—å’Œé¦¬ä¸è·¯å¾·é‡‘å¤§é“å—çš„äº¤å‰å£ï¼Œé›·å°¼çˆ¾è°·ä½å®…å¾Œé¢ï¼Œå¾é€™è£¡èµ°è·¯å¤§ç´„ä¸ƒåˆ†é˜ã€‚ä½ æœƒå¹«å¿™é™¤è‰ã€‚è¾²å ´ä¸»ä»»ä½™æ™¨å¥³å£«æœƒèªªå»£æ±è©±ã€ä¸€é»è¶Šå—è©±ã€å°å±±è©±ã€åœ‹èªï¼Œé‚„æœ‰å…¶ä»–ä¸­æ–‡æ–¹è¨€ã€‚",
    // "tha há»“ Ä‘áº¿n" = very natural Vietnamese "come anytime you like"
    "vi-VN": "NÃ´ng tráº¡i cá»™ng Ä‘á»“ng Seattle nha. Thá»© Hai hÃ ng tuáº§n, tá»« chÃ­n rÆ°á»¡i sÃ¡ng Ä‘áº¿n bá»‘n giá» chiá»u, báº¡n cá»© thoáº£i mÃ¡i Ä‘áº¿n lÃºc nÃ o cÅ©ng Ä‘Æ°á»£c trong khoáº£ng thá»i gian Ä‘Ã³. NÃ´ng tráº¡i á»Ÿ gÃ³c Ä‘Æ°á»ng South Lilac vÃ  Ä‘Æ°á»ng Martin Luther King Junior Way South, ngay phÃ­a sau khu nhÃ  á»Ÿ Rainier Valley â€” Ä‘i bá»™ khoáº£ng báº£y phÃºt tá»« Ä‘Ã¢y. Báº¡n sáº½ phá»¥ nhá»• cá». Chá»‹ Yu Chen quáº£n lÃ½ nÃ´ng tráº¡i, nÃ³i Ä‘Æ°á»£c tiáº¿ng Quáº£ng, má»™t chÃºt tiáº¿ng Viá»‡t, tiáº¿ng ÄÃ i SÆ¡n, tiáº¿ng Phá»• thÃ´ng, vÃ  nhiá»u phÆ°Æ¡ng ngá»¯ Trung Hoa khÃ¡c.",
    "fil-PH": "Seattle Community Farm po. Tuwing Lunes, mula ika-siyam at kalahati ng umaga hanggang ika-apat ng hapon â€” pumunta ka anumang oras sa pagitan nito. Nasa kanto ng S. Lilac at Martin Luther King Junior Way South, sa likod ng Rainier Valley Housing â€” mga pitong minutong lakad mula dito. Magdadamo ka roon. Si Ms. Yu Chen, ang nagpapatakbo ng farm, ay nagsasalita ng Cantonese, kaunting Vietnamese, Taishanese, Mandarin, at iba pang mga dayalekto ng Tsino."
  },
  messages: {
    "zh-CN": "çˆ±å¿ƒç•™è¨€æ´»åŠ¨ã€‚æ—¶é—´å¾ˆçµæ´»ï¼Œéšæ—¶éƒ½å¯ä»¥å‚ä¸ã€‚è¯·ä½ ä¸ºæˆ‘ä»¬çš„é•¿è¾ˆå†™ä¸‹æ¸©æš–çš„è¯è¯­ï¼Œè¿™äº›ä¿¡æ¯ä¼šåœ¨æˆ‘ä»¬é£Ÿç‰©é“¶è¡Œåˆ†å‘çš„æ—¶å€™é€åˆ°ä»–ä»¬æ‰‹ä¸­ã€‚",
    "zh-TW": "æ„›å¿ƒç•™è¨€æ´»å‹•ã€‚æ™‚é–“å¾ˆå½ˆæ€§ï¼Œéš¨æ™‚éƒ½å¯ä»¥åƒèˆ‡ã€‚è«‹ä½ ç‚ºæˆ‘å€‘çš„é•·è¼©å¯«ä¸‹æº«æš–çš„è©±èªï¼Œé€™äº›ä¿¡æ¯æœƒåœ¨æˆ‘å€‘é£Ÿç‰©éŠ€è¡Œç™¼æ”¾çš„æ™‚å€™é€åˆ°ä»–å€‘æ‰‹ä¸­ã€‚",
    // Warm Vietnamese â€” "lá»i nháº¯n yÃªu thÆ°Æ¡ng" is very natural
    "vi-VN": "ChÆ°Æ¡ng trÃ¬nh Lá»i Nháº¯n YÃªu ThÆ°Æ¡ng. Thá»i gian ráº¥t linh hoáº¡t, báº¡n cÃ³ thá»ƒ tham gia báº¥t cá»© lÃºc nÃ o thuáº­n tiá»‡n. Báº¡n sáº½ viáº¿t nhá»¯ng lá»i nháº¯n áº¥m Ã¡p gá»­i Ä‘áº¿n cÃ¡c cá»¥ giÃ  cá»§a chÃºng tÃ´i â€” nhá»¯ng lÃ¡ thÆ° nÃ y sáº½ Ä‘Æ°á»£c trao táº­n tay cÃ¡c cá»¥ táº¡i ngÃ¢n hÃ ng thá»±c pháº©m.",
    "fil-PH": "Caring Messages po. Flexible ang oras, pwede kang lumahok kahit kailan ka makakarating. Sumulat ka ng mga maiinit na mensahe para sa aming mga lolo at lola â€” ipamamahagi ang mga ito sa kanila sa aming food bank."
  }
};

function speakProgram(key) {
  const text = PROGRAM_SPEAK[key]?.[currentLang];
  if (text) speak(text, currentLang, '__prog_' + key);
  else alert('No translation available for this language yet.');
}

// â”€â”€ LISTEN & TRANSLATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LANG_NAMES = {
  "zh-CN": "Simplified Chinese",
  "zh-TW": "Traditional Chinese",
  "vi-VN": "Vietnamese",
  "fil-PH": "Tagalog"
};

const MYMEMORY_CODES = {
  "zh-CN": "zh-CN",
  "zh-TW": "zh-TW",
  "vi-VN": "vi",
  "fil-PH": "tl"
};

let recognition = null;
let isListening = false;        // true = we WANT to be listening
let capturedTranscript = '';

function updateListenPanel() {
  document.getElementById('listenLangNote').textContent =
    'Listening for: ' + (LANG_NAMES[currentLang] || currentLang);
}

function startListening() {
  if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
    document.getElementById('transcriptBox').innerHTML =
      '<span style="color:#c84b2f;">âš ï¸ Speech recognition requires Chrome on Android or desktop. It does not work in Safari.</span>';
    return;
  }

  // Kill any existing session cleanly first
  if (recognition) {
    try { recognition.abort(); } catch(e) {}
    recognition = null;
  }

  // Reset UI
  isListening = true;
  capturedTranscript = '';
  const box = document.getElementById('transcriptBox');
  const tBtn = document.getElementById('translateBtn');
  const tBox = document.getElementById('translationBox');
  const status = document.getElementById('translateStatus');
  const btn = document.getElementById('listenBtn');

  tBox.classList.remove('visible');
  tBtn.style.display = 'none';
  status.textContent = '';
  box.className = 'transcript-box';
  box.textContent = 'ğŸ¤ Speak nowâ€¦';
  btn.className = 'btn-listen listening';
  btn.innerHTML = 'ğŸ”´ Listeningâ€¦';

  _spawnRecognition();
}

function _spawnRecognition() {
  // Don't restart if we've been told to stop
  if (!isListening) return;

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = currentLang;
  recognition.continuous = false;      // false is MORE reliable cross-browser
  recognition.interimResults = true;
  recognition.maxAlternatives = 1;

  const box = document.getElementById('transcriptBox');
  const btn = document.getElementById('listenBtn');

  recognition.onresult = (event) => {
    let interimText = '';
    let newFinal = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const t = event.results[i][0].transcript;
      if (event.results[i].isFinal) newFinal += t + ' ';
      else interimText += t;
    }
    if (newFinal) capturedTranscript += newFinal;
    box.className = 'transcript-box has-text';
    box.textContent = (capturedTranscript + interimText).trim() || 'â€¦';
  };

  recognition.onerror = (e) => {
    if (e.error === 'not-allowed') {
      isListening = false;
      box.innerHTML = '<span style="color:#c84b2f;">âš ï¸ Microphone access denied. Please allow microphone in your browser settings, then try again.</span>';
      _setIdleBtn();
      return;
    }
    if (e.error === 'aborted') return; // we triggered this ourselves
    // For no-speech and network errors, just let onend restart it
  };

  recognition.onend = () => {
    if (!isListening) {
      // User pressed Stop â€” finalise
      _finishListening();
      return;
    }
    // Auto-restart â€” this is the key fix for mobile killing recognition
    setTimeout(_spawnRecognition, 150);
  };

  try {
    recognition.start();
  } catch(e) {
    // already started â€” wait and retry
    setTimeout(_spawnRecognition, 300);
  }
}

function stopListening() {
  isListening = false;
  if (recognition) {
    try { recognition.stop(); } catch(e) {}
  }
  // If onend never fires (some browsers), finalise after short delay
  setTimeout(() => {
    if (!isListening) _finishListening();
  }, 500);
}

function _finishListening() {
  const btn = document.getElementById('listenBtn');
  const tBtn = document.getElementById('translateBtn');
  const box = document.getElementById('transcriptBox');
  const status = document.getElementById('translateStatus');

  _setIdleBtn();

  if (capturedTranscript.trim()) {
    tBtn.style.display = 'block';
    status.textContent = 'âœ… Done â€” tap "Translate to English" below.';
    box.className = 'transcript-box has-text';
    box.textContent = capturedTranscript.trim();
  } else {
    status.textContent = 'Nothing captured. Make sure microphone is allowed and try again.';
  }
}

function _setIdleBtn() {
  const btn = document.getElementById('listenBtn');
  btn.className = 'btn-listen';
  btn.innerHTML = 'ğŸ¤ Start Listening';
}

async function translateText() {
  if (!capturedTranscript.trim()) return;

  const status = document.getElementById('translateStatus');
  const tBox = document.getElementById('translationBox');
  const tText = document.getElementById('translationText');
  const tFrom = document.getElementById('translationFrom');
  const tBtn = document.getElementById('translateBtn');

  status.textContent = 'â³ Translatingâ€¦';
  tBtn.disabled = true;
  tBox.classList.remove('visible');

  const langName = LANG_NAMES[currentLang] || currentLang;
  const textToTranslate = capturedTranscript.trim();

  // Try Claude API first (most accurate for these languages)
  try {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        messages: [{
          role: "user",
          content: `Translate the following ${langName} text to natural English. Return ONLY the English translation, nothing else:\n\n${textToTranslate}`
        }]
      })
    });
    const data = await response.json();
    const translation = data?.content?.[0]?.text?.trim();

    if (translation && !translation.includes('error')) {
      tText.textContent = translation;
      tFrom.textContent = langName;
      tBox.classList.add('visible');
      status.textContent = 'âœ… Translation complete.';
      tBtn.disabled = false;
      return;
    }
  } catch(e) {
    // fall through to MyMemory
  }

  // Fallback: MyMemory free API
  try {
    const sourceLang = MYMEMORY_CODES[currentLang] || 'zh-CN';
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(textToTranslate)}&langpair=${sourceLang}|en`;
    const resp = await fetch(url);
    const data = await resp.json();
    const translation = data?.responseData?.translatedText;

    if (translation && data.responseStatus === 200) {
      tText.textContent = translation;
      tFrom.textContent = langName;
      tBox.classList.add('visible');
      status.textContent = 'âœ… Translation complete.';
    } else {
      status.textContent = 'âš ï¸ Could not translate. Please check your internet connection.';
    }
  } catch (err) {
    status.textContent = 'âš ï¸ Translation unavailable. Please check your connection.';
  }

  tBtn.disabled = false;
}

// â”€â”€ VOICES ASYNC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if ('speechSynthesis' in window) {
  window.speechSynthesis.onvoiceschanged = renderPhrases;
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
renderPhrases();
updateConfirm();
updateListenPanel();
</script>
</body>
</html>
